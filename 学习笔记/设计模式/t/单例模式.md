# 单例模式

定义：保证一个类仅有一个实例，并提供一个访问它的全局访问点。

条件：

- 独一无二
- 全局访问

作用：当不存在该实例时，创建一个实例；已存在，直接返回该实例，保证只有一个实例。

通常做法：运用闭包封装，使用一个私有变量来标识是否该实例已被创建过。



### `JS`中的单例模式

全局变量不是单例模式，但在 `JavaScript` 开发中，我们经常会把全局变量当成单例来使用，因为每个对象都是独一无二的。

被声明在全局作用域下的对象，是独一无二的，而且我们可以在全局使用这个变量，这样就天然满足了单例模式的两个条件。

#### 避免使用全局变量

`Douglas Crockford` 多次把全局变量称为 `JavaScript` 中最糟糕的特性。

在对 `JavaScript` 的创造者 `Brendan Eich` 的访谈中， `Brendan Eich` 本人也承认全局变量是设计上的失误，是在没有足够的时间思考一些东西的情况下导致的结果。

##### 命名空间

适当地使用命名空间，并不会杜绝全局变量，但可以减少全局变量的数量。

```js
 var MyApp = { 
 	event: {}, 
 	dom: { 
 		style: {} 
 	},
    methods: {
        a: function () {},
        b: function () {},
        c: function () {},
    }
 };
```

对象本身就是：属性和方法的集合，将属性和方法绑定在一个全局对象中，可以避免全局污染。

##### 私有变量

使用闭包封装私有变量：把一些变量封装在闭包的内部，只暴露一些接口跟外界通信【通常使用立即执行函数来实现闭包】

```js
var user = (function(){ 
	var __name = 'sven', 
 		__age = 29; 
 	return { 
 		getUserInfo: function(){ 
 			return __name + '-' + __age; 
 		} 
	} 
})();
```



### 惰性单例

惰性单例：指的是在需要的时候才创建对象实例。惰性单例是单例模式的重点，这种技术在实际开发中非常有用。

```js
var CreateDiv = (function(){ 
	var instance; 
    
	var CreateDiv = function( html ){ 
		if ( instance ){ 
			return instance; 
		} 
		this.html = html; 
		this.init();
 		return instance = this; 
	}; 
    
	CreateDiv.prototype.init = function(){ 
		var div = document.createElement( 'div' ); 
		div.innerHTML = this.html; 
		document.body.appendChild( div ); 
	}; 
    
	return CreateDiv; 
})(); 

var a = new CreateDiv( 'sven1' ); 
var b = new CreateDiv( 'sven2' ); 
alert ( a === b ); // true
```

惰性单例的本质，就是利用闭包来实现“保证只有 / 只创建一个实例”。

##### 通用的单例模式

核心：创建对象和管理单例的职责被分布在两个不同的方法中，这两个方法组合起来才具有单例模式的威力。

```js
// 先设计一个获取单例的函数，参数：一个代理方法
var getSingle = function( fn ){ 
	var result; 
	return function(){ 
		return result || ( result = fn .apply(this, arguments ) ); 
	} 
};
// 然后传入具体的回调方法
var createLoginLayer = function(){
	var div = document.createElement( 'div' ); 
	document.body.appendChild( div ); 
	return div; 
}; 
// 执行方法获取单例
var createSingleLoginLayer = getSingle( createLoginLayer ); 
// 为单例添加事件
var bindEvent = getSingle(function(){ 
	document.getElementById( 'div1' ).onclick = function(){ 
		console.log( 'click' ); 
	} 
	return true; 
}); 
bindEvent();
```



### 总结

单例模式是一种简单但非常实用的模式，特别是惰性单例技术，在合适的时候才创建对象，并且只创建唯一的一个。

