# 常用工具

### 垃圾清理

当在项目中失误地引入了一些无用的资源，或者使用新资源替换了部分的资源后，必须清除废弃的无用资源，因为它们是该项目的垃圾。默认情况下，`webpck` 不会自动清除这些垃圾资源，而是一直堆叠资源。将垃圾资源和项目资源混合在一起，导致了项目体积越来越大。

#### 自动清理

使用 `clean-webpack-plugin`，便可以自动清理 `webpack` 输出目录中的垃圾文件。因为每次执行打包命令之后，它都先清空输出目录。这样一来，每次打包后，输出目录中就都会只剩下项目依赖的资源了。

##### 安装插件

```shell
npm i clean-webpack-plugin -D
```

##### 插件配置

使用该插件，还必须在 `output` 中指定输出目录。

```js
const path = require('path');
// 获取插件方法
const {CleanWebpackPlugin} = require('clean-webpack-plugin');

module.exports = {
    output: {
        path: path.resolve(__dirname, "./dist")
    }
    plugins: [
        new CleanWebpackPlugin() // 挂载插件实例
    ]
}
```



### 定位错误

程序在运行中报错时会提供问题代码的行号。通常，在格式化标准的代码中，都能够快速准确地定位到错误行。但 `webpack` 将 `js` 文件打包压缩成了一行代码，这样就导致无法根据行号来准确定位到错误行了。

##### 美化格式

在浏览器控制台中点击错误行，将自动定位到 `Sources` 面板中错误代码所在行。此时，代码由于被 `webpack` 打包压缩成了一行，将导致难以快速定位到问题代码的位置。

但是，可以使用浏览器自带的格式化功能来美化代码的呈现格式，使其标准化。在标准化之后，光标就能根据错误行号定位到错误行了。

格式化按钮：浏览器在 `Sources` 面板中，浏览资源区域的底部，设置了一个格式化代码的按钮（`pretty print`）—— <button><strong>{}</strong></button>。

##### 内置插件

`webpck 5` 内置了一个 `source map` 开发工具，用于在开发时格式化打包后的代码文件，只需要进行相应的配置即可使用。

```js
module.exports = {
    mode: "development",
    devtool: "inline-source-map"
}
```

该工具必须在开发模式下使用。另外，`source map` 不只一种，更多参考：[`devtool` 配置](https://webpack.docschina.org/configuration/devtool/)、[`source-maps`](https://survivejs.com/webpack/building/source-maps/)。



### 观察模式

开启观察模式，将会监听项目依赖文件的变化。如果其中一个文件被更新，项目将自动被重新打包编译。

更多参考：[使用观察模式](https://webpack.docschina.org/guides/development#using-watch-mode) 

##### 开启观察

执行 `npx webpack --watch` 指令，便可以开启观察模式。

```shell
npx webpack --watch
```

更多参考：[`watch` 和 `watchOptions`](https://webpack.docschina.org/configuration/watch#root) 



### 模块更新

`webpack-dev-server` 工具提供的服务器，在任一模块被更新后，都会实时编译和打包项目，并且实时刷新页面。这在填写表单等只需要局部更新时会带来麻烦，因为刷新页面会导致页面被重置。实际上，我们只需要局部的更新（即：只更新发生变化的模块及其依赖）。

##### 模块配置

通过配置 `devServer`，来开启模块的热更新（只打包和编译发生变化的模块及其依赖，而不是整个项目）。

```js
module.exports = {
    devServer: {
        hot: true // 开启模块的热更新
    }
}
```

##### 开启监听

在入口 `js` 文件中，监听其依赖的模块是否发生了变化。在 `module.hot.accept` 方法中指定要监听的模块。

```js
if(module.hot) {
    module.hot.accept([
        "./js/a.js" // 指定要监听的模块
    ])
}
```

当被监听的模块发生更新时，不会导致整个项目的重新编译和打包，因此不会再刷新整个页面。而是只编译和打包该模块及其依赖。



### 兼容处理

浏览器只识别 `HTML`、`CSS` 和 `JS` 三大语言。因此，开发者使用的高级语言浏览器是不能识别的，必须经过向后兼容的处理。`webpack` 的兼容处理便主要是兼容浏览器。另外，对于 `HTML5`、`CSS3` 和 `JS` 这三大语言的高版本语法，浏览器也并不是完全兼容的。

##### 原生兼容方式

浏览器原生的 `CSS` 兼容，是通过给 `CSS` 代码加浏览器前缀的方式来实现对特定浏览器的兼容的。因为有些 `CSS` 代码并未完全得到所有浏览器的支持，可能只有部分浏览器实现了它们。而实现了的浏览器，会在这些代码前加上自己的前缀。没有前缀的代码则都被支持了。

```css
p {
    user-select: none; /* 通用浏览器 */
    -moz-user-select: none; /* 火狐浏览器 */
    -webkit-user-select: none; /* 谷歌浏览器 */
}
```

为了兼容浏览器，人为地添加大量重复的兼容代码是很繁琐的，大大影响了开发效率。使用相应的兼容插件便可以将这些工作交给插件。

##### 浏览器兼容性

有些浏览器已经停止了维护，而每个项目也不需要兼容所有的浏览器，应根据每个项目主要面向的用户来选择性地决定使用哪些浏览器。使用 `webpack` 就可以指定要兼容哪些浏览器。可以使用[浏览器兼容性查看工具](https://caniuse.com/)来查看市场上活跃的浏览器，以及它们所占的份额。

该工具可以查看各种浏览器对 `HTML5`、`CSS3` 以及 `ES6` 或更高版本等语法的支持程度。点击 `Site links` 的 [`Browser usage table`](https://caniuse.com/usage-table)，便可以查看各主流浏览器的版本以及市场份额。

输入 `npx browserslist` 指令，可以查看 `webpack` 目前主要兼容的浏览器列表。

```shell
npx browserslist
```

输出的列表如下：

```shell
and_chr 108
and_ff 107
and_qq 13.1
and_uc 13.4
android 108
chrome 108
chrome 107
chrome 106
edge 108
edge 107
firefox 107
firefox 106
firefox 102
ios_saf 16.2
ios_saf 16.1
ios_saf 16.0
ios_saf 15.6
ios_saf 15.5
ios_saf 14.5-14.8
kaios 2.5
op_mini all
op_mob 72
opera 92
opera 91
safari 16.2
safari 16.1
safari 15.6
samsung 19.0
samsung 18.0
```

##### 指定浏览器

在 `package.json` 配置文件中，可以通过定义其根属性 `browserslist` 的值（过滤条件），来指定该项目需要兼容的浏览器。

```json
{
    "browserslist": [
    	"> 1%", 		// 市场所占份额大于1%的浏览器
        "not dead", 	// 仍然活跃的浏览器（除去不再被维护的浏览器）
        "not ie <= 11" 	// IE9以上的IE浏览器（除去IE9及以下的IE浏览器）
    ]
}
```

上述配置表示 —— 兼容市场占有份额大于1%且仍然活跃的浏览器，另外指定除去 `IE9` 及以下的 `IE` 浏览器。

更多参考：[`browserslist` 配置](https://webpack.docschina.org/configuration/target/#browserslist)、[`browserslist` 文档](https://github.com/browserslist/browserslist#full-list)

经过如上步骤，确定了项目要兼容的浏览器之后，便可以使用相应的 `loader` 或插件对这些浏览器进行兼容处理了。

