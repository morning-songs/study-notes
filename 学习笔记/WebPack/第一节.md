# `WebPack`

`Webpack` 发行上线于 2013 年 12 月，是一款资格很老的项目打包构建工具。到目前为止，其生态相当丰富，很多的项目都是使用它来进行打包的。当然，新出现的 `Vite` 也正迸发着无限的青春活力。但目前主流的打包工具，仍然是 `webpack`。

基本作用：无论是什么样的构建工具，`webpack` 也好，`vite` 也好。都具备如下的三个基本作用：

- 处理模块之间的依赖关系
- 将开发时所使用的高级语法编译成浏览器能够识别的语法（即：`HTML`、`CSS` 和 `JS`）
- 处理兼容性的问题



### 基础

`Webpack` 是现代 `JS` 应用程序中的静态模块打包器，主要作用是对前端资源打包、压缩和优化。`webpack` 处理应用程序时，会在内部从一个或多个入口点构建一个依赖图，然后将项目中所需要的每一个模块组合成一个或多个。

`webpack` 社区生态丰富，提供了丰富的插件和 `loader`。配置灵活，还有插件化扩展，并且能自定义 `loader` 和插件以满足个性需求。

##### 五大核心

`webpack` 有五大核心概念：

- `Entry`：指定 `webpack` 开始构建的入口模块
- `Output`：指定 `webpack` 如何命名打包输出的文件以及输出目录
- `Loaders`：`webpack` 只能处理 `js` 文件，所以需要使用 `loader` 去将非 `js` 文件处理成 `webpack` 能处理的模块。
- `Plugins`：执行范围更广的任务，插件范围包括：从打包、优化和压缩一直到重新定义环境中的变量。
- `Mode`：指定 `webpack` 的运行环境。在开发环境中值为 `development`，生产环境中值为 `production`。



### 安装

安装 `webpack`，应该局部安装。因为每个项目都可以使用 `webpack` 打包，而打包的各个项目之间的 `webpack` 配置未必能够兼容。

建议：每个项目对于打包时的配置可能不同。因此，应该采取局部安装的方式为每个项目都安装 `webpack`，方便进行个性化配置。

##### 局部安装

在开始一个新项目之前，应该先对项目进行一下初始化。然后再针对项目，局部安装一些第三方工具，比如：`webpack`。

```shell
npm init -y
```

局部安装 `webpack`，并且同步安装 `webpack` 的命令工具包 `webpack-cli`（用于在命令行中运行 `webpack`）。

```shell
npm i webpack webpack-cli --save-dev
```

##### 版本检查

使用 `npx webpack -v` 指令，检查安装的 `webpack` 版本号。`npx` 是由 `webpack-cli` 提供的指令。

```shell
npx webpack -v
```



### 使用

使用 `webpack`，以 `webpack-demo` 项目为例。

更多参考：[起步](https://webpack.docschina.org/guides/getting-started) 

##### 目录结构

安装好 `webpack` 之后，要先在项目的根目录下新建几个重要的文件。【`+` 表示新增（绿色），`-` 表示移除（红色）】

```diff
webpack-demo /* 根目录 */
|- package.json
|- package-lock.json
+ |- /dist
+ 	|- index.html
+ |- /src
+	|- index.js
```

新建 `dist` 目录，并在其中新建 `index.html` 文件（入口页面）。新建 `src` 目录，并在其中新建 `index.js` 文件（入口文件）。

不过，实际中更习惯的做法是，在一个 `src` 目录中存放项目的所有资源。

```diff
webpack-demo
|- package.json
|- package-lock.json
+ |- /src
+ 	|- index.html
+	|- index.js
```

##### 入口文件

`webpack` 的入口文件默认是 `src` 根目录下的 `index.js` 文件。

##### 打包项目

使用 `npx webpack` 指令，将以入口 `js` 文件为起点，对项目进行打包处理。

```shell
npx webpack
```

##### 文件合并

以入口 `js` 文件为起点，将它与其所依赖的所有 `js` 文件合并成一个 `js` 文件 —— `main.js` 文件（并存放到 `dist` 目录中）。

##### 指令替换

在 `package.json` 文件的 `"scripts"` 选项中，可以自定义一个 `"build"` 指令，设其值为 `"webpack"`。将此后在命令行工具中要使用 `webpack` 的地方，都使用 `build` 来代替。并且，`npx` 指令也要被替换成 `npm run`。

```json
// 在package.json文件中
{
    "scripts": {
        "build": "webpack"
    }
}
```

```shell
npm run build /* 替换原先的：npx webpack */
```

##### 打包模式

默认使用生产模式进行打包。生产模式会将代码压缩至最短，它会将 `js` 文件中注释去掉，并将变量名和空格进行压缩。

特别需要注意的是，生产模式下的 `webpack` 在打包时会自动删除所有死代码（即：从来没有被使用过的代码）。

```js
// 死代码
let a = 0;

function fn() {
    console.log(a);
}
```

如果只在 `js` 文件中进行变量或函数声明，而没有任何执行语句的话，该文件在打包后就会成为一个空文件。比如，上面的这个文件。

##### 引入文件

项目打包后，会在 `dist` 中生成一个 `main.js` 文件。要使用该文件，就必须将其引入到项目的入口页面 `index.html` 文件中。

```html
<script src="../dist/main.js"></script>
```



### 配置

要配置 `webpack`，首先要在项目根目录下，创建 `webpack.config.js` 文件（`webpack` 配置文件）。

**注意**：这是一个 `js` 文件。其中，使用 `node` 的语法来进行配置。正因此，`webpack` 对安装的 `Node` 版本是有要求的。比如：运行 `webpack 5` 的 `Node.js` 最低版本是 10.13.0（`LTS`）。

##### 导出配置

在 `webpack.config.js` 文件中，使用 `module.exports` 属性将 `webpack` 的配置导出使用。

```js
// 导出webpack配置
module.exports = {
    // webpack配置
}
```

##### 打包模式

`mode` 选项用于指定 `webpack` 的打包模式。包括：开发模式（`development`）和生产模式（`production`）。其中，默认为生产模式。

```js
module.exports = {
    mode: "development"
}
```

##### 打包入口

`entry` 用于指定 `webpack` 的打包入口，即：输入文件。默认情况下，其值是 `src` 目录下的 `index.js` 文件。

```js
module.exports = {
    entry: "./src/index.js"
}
```

##### 打包出口

`output` 用于指定 `webpack` 的打包出口，即：输出文件。默认情况下，是 `dist` 目录下的 `main.js` 文件。

`output` 值为对象，其中有两个配置选项：`path` 用于指定输出目录，`filename` 用于指定输出文件的名称。

特别需要注意的是，`path` 的值必须是一段绝对路径字符串。这里，便可以导入 `node` 的路径模块进行操作。

```js
const path = require("path");

module.exports = {
    output: {
        path: path.resolve(__dirname, "./dist"), // 如果该目录不存在，则会生成它。
        filename: "main.js"
    }
}
```

##### 自定义配置文件

`webpack` 默认的配置文件是 `webpack.config.js` 文件。但用户可以自定义配置文件，如：`demo.js`，然后在打包时指定将该文件作为配置文件使用。在 `npx webpack --config` 后输入 `demo.js` 即可。

```shell
npx webpack --config demo.js /* 指定配置文件为：demo.js */
```

